#+STARTUP: overview
#+AUTHOR: Diamond Bond
#+LANGUAGE: en
#+html: <a href="https://www.gnu.org/software/emacs/"><img alt="GNU Emacs" src="https://github.com/minad/corfu/blob/screenshots/emacs.svg?raw=true"></a>
#+html: <img src="https://raw.githubusercontent.com/DiamondBond/emacs/master/img/gnusstorm-2.gif">
#+OPTIONS: toc:nil num:nil

* Introduction
A sensible Emacs distro aimed at enhancing the default experience.

* Quick Start

Install the latest [[https://github.com/DiamondBond/emacs/blob/master/README.org/#compiling][Emacs@HEAD]] compiled from source with these [[https://github.com/DiamondBond/emacs/blob/master/README.org#configuration][configure flags]].

Clone this repository to =~/.emacs.d= or =~/.config/emacs=:

#+caption: Command to clone this Emacs distros =git= repository.
#+name: li#git_clone
#+begin_src sh

  git clone https://github.com/diamondbond/emacs ~/.emacs.d

#+end_src

* Principles

This configuration and all associated modules intend to follow the below priniciples.

** Performant

Responsive & adheres to function over form principles.

** Reproducible

Utilizes straight.el for reproducibility & increased stability.

** Literate

Comments & inline doc-strings.

** Correct

Aggressively utilizes best practices.

Where possible, we will leverage built-in Emacs functionality instead of external packages.

** Modular

The base configuration only sets up Emacs to have a cleaner presentation with sensible defaults.
It is up to the user to decide how to customize it.

Configuration modules should depend on other modules and the base configuration as little as possible. When a configuration module needs to integrate with other functionality in Emacs, the standard extensibility points of each package should be used (instead of expecting our own configuration module).

The implication is that someone should be able to install or copy code from this configuration into their own configuration without using this Emacs distro.

* Modules

This list is in chronological load order.

- [[file:early-init.el][early-bootstrap]] :: Early bootstrap
- [[file:init.el][bootstrap]] :: Bootstrap straight.el
- [[https://github.com/DiamondBond/emacs/blob/master/config.org#base][base]] :: Base configuration
- [[https://github.com/DiamondBond/emacs/blob/master/config.org#use-package][packages]] :: Package manifest
- [[https://github.com/DiamondBond/emacs/blob/master/config.org#keybinds][keybinds]] :: Keybinding maps
- [[https://github.com/DiamondBond/emacs/blob/master/config.org#functions][functions]] :: Function definitions

* Post Setup

Once Emacs launches for the first time we need to setup a few more things for everything to work correctly.

** Compile pdf-tools

Install pdf-tools.

#+begin_quote
  M-x pdf-tools-install
#+end_quote

** Compile vterm modules

Compile vterm-modules & setup vterm.

#+begin_quote
  M-x vterm
#+end_quote

** Setup all-the-icons

Download & install the all-the-icons font.

#+begin_quote
  M-x all-the-icons-install-fonts
#+end_quote

** Setup Email

mu4e (mu) & offlineimap to manage Email within Emacs.

*** 0. Prerequisites

Create your maildir in $HOME as ~/mail

#+begin_src sh
  mkdir -p ~/mail
#+end_src

*** 1. Configuring offlineimap

~/[[https://github.com/DiamondBond/dotfiles/blob/master/.offlineimaprc][offlineimap.rc]]

[[https://github.com/DiamondBond/dotfiles/blob/master/.offlineimap.py][~/offlineimap.py]]

*** 2. Configuring mu

Please refer to [[https://github.com/DiamondBond/emacs/blob/master/config.org#prerequisites][mu Setup]] in config.org.

**** Compile mu

Compile mu & mu4e.

#+begin_quote
M-x mu-setup/build-mu-binary
#+end_quote

**** Initialize mu

Initialize mu with maildir & address.

#+begin_quote
M-x mu-setup/init-mu
#+end_quote

**** Build mu index

Inform mu as to the contents of ~/mail by building/rebuilding the mu index.

#+begin_quote
M-x mu-setup/rebuild-mu-index
#+end_quote

* Dependencies

** Packages

*** System

#+begin_quote
offlineimap
fzf ripgrep ag
clang clangd llvm
texlive-latex-recommended
imagemagick
editorconfig
libjansson
rust-all cargo
nodejs npm
libxml2
gopls
prettier
#+end_quote

*** Python

#+begin_src bash
  pip3 install pyflakes isort nose pytest pygifsicle nose2 httpserver future pandas numpy matplotlib python-rofi
#+end_src

*** NPM

Deno & typescript-language-server for Typescript (TS/TSX) support.

#+begin_src bash
  sudo npm install -g deno typescript-language-server bash-language-server
#+end_src

** Files

*** ~/org & ~/pdfs

Symlink ~/org & ~/pdf to their respective subdirs within ~/Dropbox.

#+begin_src sh
  mkdir -p ~/Dropbox/{org,pdfs}; ln -s ~/Dropbox/org ~/org; ln -s ~/Dropbox/pdfs ~/pdfs
#+end_src

*** auth-info

1. ~/org/.authinfo.gpg
2. ~/org/secrets-el.gpg
3. ~/org/network-security.data

*** Emacs related files

1. ~/.emacs.d/places
2. ~/.emacs.d/recentf
3. ~/.emacs.d/custom.el

** Emacs

How to compile and install the latest GNU Emacs @ HEAD.

*** Grabbing sources

Clone the latest emacs sources:

#+begin_src sh
  cd ~/git
  git clone -b master git://git.sv.gnu.org/emacs.git
#+end_src

*** Configuration

Configure Emacs with json, native-comp, xinput2 and the athena toolkit with xaw3d-toolbars.

#+begin_src sh
  # Run the auto-generation script
  ./autogen.sh

  # Configure Emacs
  ./configure --with-dbus --with-gif --with-jpeg --with-png --with-rsvg --with-tiff --with-xft --with-xpm --with-gpm=no --disable-silent-rules --with-modules --with-file-notification=inotify --with-mailutils --with-x=yes --with-x-toolkit=athena --without-gconf --without-gsettings --with-lcms2 --with-imagemagick --with-xml2 --with-json --with-harfbuzz --without-compress-install --with-native-compilation --with-xinput2 CFLAGS="-O3 -mtune=native -march=native -fomit-frame-pointer -flto -fno-semantic-interposition"
  # note: Remove "--with-xinput2" if your target build is Emacs28
#+end_src

*** Compiling

Compile with all cores and native full ahead of time compilation, this takes a while.

#+begin_src sh
  make NATIVE_FULL_AOT=1 -j$(nproc)
  sudo make install
#+end_src
